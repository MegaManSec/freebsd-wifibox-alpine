# Maintainer: Gabor Pali <pali.gabor@gmail.com>

pkgname='rtl8821ce'
pkgver=20230101
pkgrel=3
_gitrev='a3e2f7c1f91e92f2dc788e8fcd7f2986af3d19b6'
pkgdesc='Driver for Realtek 8821CE, an 802.11ac device'
arch="x86_64"
url='https://github.com/tomaspinho/rtl8821ce'
license="GPL-2.0"
makedepends="linux-lts-dev xz"
depends="linux-lts"
install=
options="!check !strip"
source="https://github.com/tomaspinho/rtl8821ce/archive/${_gitrev}.zip"

_kver=$(cd /usr/src/ && find . -mindepth 1 -maxdepth 1 -type d | sed 's!./linux-headers-!!')
_kbase="/lib/modules/${_kver}"
_srcdir="$srcdir/rtl8821ce-$_gitrev"

build() {
  make -C "$_srcdir" -j8 KVER="$_kver"
}

package() {
  xz "$_srcdir"/*.ko
  install -p -D -m 644 "$_srcdir"/*.ko.xz -t "$pkgdir"/lib/modules/"$_kver"/kernel/drivers/net/wireless/realtek/rtl8821ce
}

sha512sums="
8904d0d331d83b280f32c26e6d1f1bccf38d9933d58f9c9c7ee2d1b67e2e5a5c706b22cc224805f1572ccaa0dc8c7b650c77e710b51dc0a00596383b1356c413  a3e2f7c1f91e92f2dc788e8fcd7f2986af3d19b6.zip
"
