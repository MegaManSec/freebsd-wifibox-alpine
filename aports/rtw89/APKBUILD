# Maintainer: Gabor Pali <pali.gabor@gmail.com>

pkgname='rtw89'
pkgver=20220819
pkgrel=0
_gitrev='e3ef10e3a6b3a002af800d658efa904e0d30f1a2'
pkgdesc='Driver for Realtek 8852AE, an 802.11ax device'
arch="x86_64"
url='https://github.com/lwfinger/rtw89'
license="GPL-2.0"
makedepends="linux-lts-dev xz"
depends="linux-lts"
install=
options="!check !strip"
source="https://github.com/lwfinger/rtw89/archive/${_gitrev}.zip"

_kver=$(cd /usr/src/ && find . -mindepth 1 -maxdepth 1 -type d | sed 's!./linux-headers-!!')
_kbase="/lib/modules/${_kver}"
_srcdir="$srcdir/rtw89-$_gitrev"

build() {
  make -C "$_srcdir" -j KVER="$_kver"
}

package() {
  xz "$_srcdir"/*.ko
  install -p -D -m 644 "$_srcdir"/*.ko.xz -t "$pkgdir"/lib/modules/"$_kver"/kernel/drivers/net/wireless/realtek/rtw89 
  install -p -D -m 644 "$_srcdir"/rtw8852a_fw.bin -t "$pkgdir"/lib/firmware/rtw89
}

sha512sums="
abd79af6156b163aab0c1f8ed4c382f699bb504a9d7a63476d601a384cd996a397c7f4432fdebd643e08d92b196a18297478e09937fbdfa3db18492e13dee222  e3ef10e3a6b3a002af800d658efa904e0d30f1a2.zip
"
